#### 1. 什么是JIT？

JIT（Just-In-Time）是Java虚拟机（JVM）中的一种编译器技术，用于提高Java程序的执行效率。

在Java程序执行过程中，JVM会将Java字节码解释成机器码并执行。而JIT编译器则是在程序运行时，**将热点代码（频繁执行的代码）编译成机器码**，以提高执行速度。JIT编译器的编译过程是在程序运行过程中进行的，只对热点代码进行编译，而不是对整个程序进行编译。

JIT编译器的工作原理如下：

1. 程序开始执行时，JVM会将Java字节码解释成机器码并执行。
2. 在执行过程中，JVM会监控程序的执行情况，记录热点代码的执行频率。
3. 当某段代码被判定为热点代码时，JIT编译器会将这段代码编译成机器码，并替换原来的解释执行代码。
4. 编译后的机器码执行速度更快，因此可以提高程序的执行效率。

JIT编译器的使用可以显著提高Java程序的执行速度，特别是对于那些包含大量循环和频繁调用的代码。然而，JIT编译器的编译过程需要一定的时间，因此在程序刚开始执行时，可能会有一些性能损失。但随着程序的执行，JIT编译器会逐渐将热点代码编译成机器码，从而提高程序的整体性能。



#### 2. JIT热点检测

要想触发JIT，首先需要识别出热点代码。目前主要的热点代码识别方式是热点探测（Hot Spot Detection），有以下两种：

- 基于采样的方式探测（Sample Based Hot Spot Detection) ：周期性检测各个线程的栈顶，发现某个方法经常出险在栈顶，就认为是热点方法。好处就是简单，缺点就是无法精确确认一个方法的热度。容易受线程阻塞或别的原因干扰热点探测。
- 基于计数器的热点探测（Counter Based Hot Spot Detection)。采用这种方法的虚拟机会为每个方法，甚至是代码块建立计数器，统计方法的执行次数，某个方法超过阀值就认为是热点方法，触发JIT编译。



在HotSpot虚拟机中使用的是第二种——基于计数器的热点探测方法，因此它为每个方法准备了两个计数器：方法调用计数器和回边计数器。

方法计数器。顾名思义，就是记录一个方法被调用次数的计数器。

回边计数器。是记录方法中的for或者while的运行次数的计数器。