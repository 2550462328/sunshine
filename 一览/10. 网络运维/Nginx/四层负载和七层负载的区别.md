负载均衡建立在现有网络结构之上，提供了一种廉价、有效、透明的方法来扩展网 络设备和服务器 的带宽，增加了 吞 吐量 ，加强了网络数据处理能力，并提高了网 络的灵 活性和可用性 。 项目中常用的负载均衡有四层负载均衡和七层负载均衡 。



**四层负载均衡与七层负载均衡的对比**

四层负载均衡基于 IP 和端口的方式实现网络的负载均衡，具体实现为对外提供一个 虚拟 IP 和端口接收所有用户的请求，然后根据负载均衡配置和负载均衡策略将请求发送 给真实的服务器 。

七层负载均衡基于 URL 等资源来实现应用层基于 内 容 的负载均衡，具体实现为通过 虚拟的 URL 或主机名接收所有用户的请求，然后将请求发送给真实的服务器 。

四层负载均衡和七层负载均衡的最大差别是： 四层负载均衡只能针对 IP 地址和端口 上的数据做统一的分发，而七层负载均衡能根据消息的内容做更加详细的有针对性的负 载均衡。 我们通常使用 LVS 等技术实现基于 Socket 的四层负载均衡，使用 Nginx 等技术 实现基于 内容分发的七层负载均衡，比如将以 “/user/*”开头的 URL 请求负载到单点 登录服务器，而将以“ /business/＊”开头的 URL 请求负载到具体的业务服务器，如 图所示 。

![img](http://pcc.huitogo.club/cf1cb2d1cac42099e8ffddf6ae75b322)



**四层负载均衡**

四层负载均衡主要通过修改报文中的目标地址和端口来实现报文的分发和负载均衡 。

以 TCP 为例，负载均衡设备在接收到第 l 个来自 客户端 的 SYN 请求后，会根据负载均 衡配置和负载均衡策略选择一个最佳的服务器，并将报文中的目标 IP 地址修改为该服务 器的 IP 直接转发给该服务器 。 TCP 连接的建立（ 即 三次握手过程）是在客户端和服务器 端之间完成的，负载均衡设备只起到路由器的转发功能。



四层负载均衡常用的软硬件如下 。

- FS ： 硬件负载均衡器，功能完备，价格昂贵 。
- LVS ：基于 IP＋端口 实现的四层负载软件，常和 Keepalive 配合使用 。
- Nginx ：同时实现四层负载 和七层负载均衡，带缓存功能，可基于正则表达式灵活转发。



**七层负载均衡**

七层负载均衡又叫作“内容负载均衡”，主要通过解析报文中真正有意义的应用层内 容，并根据负载均衡配置和负载均衡策略选择一个最佳的服务器响应用户的请求 。

七层应用负载可以使整个网络更智能化，七层负载均衡根据不 同的数据类型将数据 存储在不同的服务器上来提高网络整体的负载能力 。 比如将客户端的基本信息存储在内存较大的缓存服务器上，将文件信息存储在磁盘空 间较大的文件服务器上， 将图片视频 存储在 网 络 I/O 能力较强的流媒体服务器上 。 在接收到不同的客户端的请求时从不 同 的 服务器上获取数据并将其返回给客户端 ，提高客户端的访问效率 。



七层负载均衡常用的软件如下 ：

- HAProxy ： 支持七层代理 、会话保持 、 标记 、 路径转移等 。
- Nginx ： 同时实现四层负载和七层负载均衡，在 HTTP 和 Mail 协议上功能 比较好 ， 性能与 HAProxy 差不多 。
- Apache ： 使用简单，性能较差。