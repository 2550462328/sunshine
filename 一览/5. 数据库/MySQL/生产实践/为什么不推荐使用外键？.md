#### 1. 为什么使用外键？

外键的作用,主要有两个: 

-  一个是让数据库自己通过外键来保证数据的完整性和一致性
-  一个就是能够增加ER图的可读性 



例如有两个表   

>  A(a,b)   :a为主键，b为外键（来自于B.b)   
>  B(b,c,d)   :b为主键    

 如上面，A中的b要么为空，要么是在B的b中存在的值，有外键的时候，数据库会自动帮你检查A的b是否在B的b中存在。



建键几个原则:

1. 为关联字段创建外键。
2. 所有的键都必须唯一。
3. 避免使用复合键。
4. 外键总是关联唯一的键字段。 



在MySQL 3.23.44版本后，InnoDB引擎类型的表支持了外键约束。

外键的使用条件：

1. 两个表必须是InnoDB表，MyISAM表暂时不支持外键（据说以后的版本有可能支持，但至少目前不支持）；
2. 外键列必须建立了索引，MySQL 4.1.2以后的版本在建立外键时会自动创建索引，但如果在较早的版本则需要显示建立； 
3. 外键关系的两个表的列必须是数据类型相似，也就是可以相互转换类型的列，比如int和tinyint可以，而int和char则不可以；
   


总的来说，**外键是数据库一级的一个完整性约束**，就是数据库基础理论书中所说的“参照完整性”的数据库实现方式。



#### 2.为什么不使用外键？

##### 2.1 外键的性能问题

1. 数据库需要维护外键的内部管理；
2. 外键等于把数据的一致性事务实现，全部交给数据库服务器完成；
3. 有了外键，当做一些涉及外键字段的增，删，更新操作之后，需要触发相关操作去检查，而不得不消耗资源；
4. 外键还会因为需要请求对其他表内部加锁而容易出现死锁情况；



##### 2.2 外键设计问题（对SQL标准的背离）

1. 所有tables必须是InnoDB型，它们不能是临时表。

2. 不支持对外键列的索引前缀。这样的后果之一是BLOB和TEXT列不被包括在一个外键中，这是因为对这些列的索引必须总是包含一个前缀长度

3. InnoDB不对那些外键或包含NULL列的被引用键值检查外键约束

4.  **默认的行为应被延迟检查（即约束仅在整个SQL语句被处理之后才被检查）**

   类似一般的MySQL，在一个插入，删除或更新许多行的SQL语句内，InnoDB逐行检查UNIQUE和FOREIGN KEY约束。

   直到InnoDB实现延迟的约束检查之前，一些事情是不可能的，比如删除一个通过外键参考到自身的记录。