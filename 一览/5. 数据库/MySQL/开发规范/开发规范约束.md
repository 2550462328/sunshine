#### 1. 开发规范

1）所有数据库对象名称必须使用小写字母并用下划线分割



2）临时库表必须以 tmp为前缀并以日期为后缀，备份表必须以 bak_为前缀并以日期 (时间戳) 为后缀



3）所有存储相同数据的列名和列类型必须一致（一般作为关联列，如果查询时关联列类型不一致会自动进行数据类型隐式转换，会造成列上的索引失效，导致查询效率降低）



4）数据库和表的字符集统一使用 UTF8



5）所有表必须使用 Innodb 存储引擎



6）所有表和字段都需要添加注释



7）禁止在数据库中存储图片,文件等大的二进制数据



8）禁止在线上做数据库压力测试



9）禁止从开发环境,测试环境直接连接生产环境数据库



10）尽量做到冷热数据分离,减小表的宽度



11）尽量控制单表数据量的大小,建议控制在 500 万以内



12）对于大表使用 pt-online-schema-change 修改表结构

- 避免大表修改产生的主从延迟
- 避免在对表字段进行修改时进行锁表



对大表数据结构的修改一定要谨慎，会造成严重的锁表操作，尤其是生产环境，是不能容忍的。



pt-online-schema-change 它会首先建立一个与原表结构相同的新表，并且在新表上进行表结构的修改，然后再把原表中的数据复制到新表中，并在原表中增加一些触发器。把原表中新增的数据也复制到新表中，在行所有数据复制完成之后，把新表命名成原表，并把原来的表删除掉。把原来一个 DDL 操作，分解成多个小的批次进行。



#### 2. 字段规范

1）尽量使用TINYINT、SMALLINT、MEDIUM_INT作为整数类型而非INT，如果非负则加上UNSIGNED。

```
1. SIGNED INT -2147483648~2147483647 

2. UNSIGNED INT 0~4294967295 
```

无符号相对于有符号可以多出一倍的存储空间



2）VARCHAR的长度只分配真正需要的空间

VARCHAR(N) 中的 N 代表的是字符数，而不是字节数，使用 UTF8 存储 255 个汉字 Varchar(255)=765 个字节。过大的长度会消耗更多的内存。



3）使用整数代替字符串类，避免使用 ENUM 类型

修改 ENUM 值需要使用 ALTER 语句

ENUM 类型的 ORDER BY 操作效率低，需要额外操作



4）使用 TIMESTAMP(4 个字节)（推荐） 或 DATETIME 类型 (8 个字节) 存储时间

TIMESTAMP 存储的时间范围 1970-01-01 00:00:01 ~ 2038-01-19-03:14:07

TIMESTAMP 占用 4 字节和 INT 相同，但比 INT 可读性高

超出 TIMESTAMP 取值范围的使用 DATETIME 类型存储

DATETIME存储的时间范围 1000-01-01 00:00:00 ~ 9999-12-31 23:59:59



在TIMESTAMP和 DATETIME都可以使用的情况下优先使用TIMESTAMP，原因有二

- DATETIME会占据更大的空间。
- DATETIME不支持时区变化，而TIMESTAMP类型会随时区变化而变化。



5）单表不要有太多字段，建议在20以内



6）尽可能把所有列定义为 NOT NULL

- 索引 NULL 列需要额外的空间来保存，所以要占用更多的空间
- 进行比较和计算时要对 NULL 值做特别的处理



7）用整型来存IP

插入数据前，先用 inet_aton 把 ip 地址转为整型，可以节省空间，显示数据时，使用 inet_ntoa 把整型的 ip 地址转为地址显示即可。



8）用char(11)存储手机号

不能用int，int的最大值是2147483647，手机号是11位

其次字符串可以用like模糊查询。



9）同财务相关的金额类数据必须使用 decimal 类型

- 非精准浮点：float,double
- 精准浮点：decimal