我们从Mysql的两大存储引擎Innodb和MyISAM来比较

Innodb和MyISAM底层都是使用B+Tree数据结构。而Innodb使用的是聚簇索引，MyISAM使用的是非聚簇索引。



两者有什么区别呢？

下面是一张公司表的索引在不同存储引擎下的查找方式，其中ID是主键，Name是普通索引

![img](http://pcc.huitogo.club/35d503e24769b14c75ef6b61b2b83b22)



- 对于聚簇索引，如果对ID进行查询，会直接对主键索引进行查找，在叶子节点存放的是该行的数据；如果对Name进行查询，会先在辅助键索引表根据Name进行查找，拿到相应的主键再到主键索引进行查找。
- 对于非聚簇索引，通过主键索引和辅助键索引发生的查询操作是一样的，但是在叶子节点存放的是该行数据在内存中的地址。

所以非聚簇索引比聚簇索引多了一次读取数据的IO操作，所以查找性能上会差。



那聚簇索引有什么**优势**呢？

1. 由于行数据和叶子节点存储在一起，同一页中会有多条行数据，访问同一数据页不同行记录时，已经把页加载到了Buffer中，再次访问的时候，会在内存中完成访问，不必访问磁盘。这样主键和行数据是一起被载入内存的，找到叶子节点就可以立刻将行数据返回了，如果按照主键Id来组织数据，获得数据更快。
2. 聚簇索引适合用在排序的场合，非聚簇索引不适合
3. 取出一定范围数据的时候，使用用聚簇索引速度快
4. 可以把相关数据保存在一起。例如实现电子邮箱时，可以根据用户 ID 来聚集数据，这样只需要从磁盘读取少数的数据页就能获取某个用户的全部邮件。如果没有使用聚簇索引，则每封邮件都可能导致一次磁盘 I/O。



聚簇索引的**缺点**有哪些？

如果使用UUId（随机ID）作为主键，使数据存储稀疏，这就会出现聚簇索引有可能有比全表扫面更慢，

![img](http://pcc.huitogo.club/c976ede8d764463a2b184fd8f09167af)



所以建议使用int的auto_increment作为主键

![img](http://pcc.huitogo.club/462a8181ac8bc7df6a5ce28defdbb9cd)



如果主键比较大的话，那辅助索引将会变的更大，因为辅助索引的叶子存储的是主键值；过长的主键值，会导致非叶子节点占用占用更多的物理空间



**为什么主键通常建议使用自增id?**

聚簇索引的数据的物理存放顺序与索引顺序是一致的，即：**只要索引是相邻的，那么对应的数据一定也是相邻地存放在磁盘上的**。

因为MyISAM的主索引并非聚簇索引，那么他的数据的物理地址必然是凌乱的，拿到这些物理地址，按照合适的算法进行I/O读取。聚簇索引则只需一次I/O。（强烈的对比）

不过，如果涉及到大数据量的排序、全表扫描、count之类的操作的话，还是MyISAM占优势些，因为索引所占空间小，这些操作是需要在内存中完成的。